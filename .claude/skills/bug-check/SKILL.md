---
name: bug-check
description: 按照项目 Bug 检查清单逐项审查本次代码改动。当用户提到"检查 bug"、"bug 检查"、"checklist 检查"、"检查代码问题"、"编码检查"、或在完成功能开发后需要质量审查时使用。
---

# Bug 检查

按照项目 Bug 检查清单 `docs/guides/development/bug-checklist.md` 逐项审查本次代码改动。

## 工作流程

### 1. 确定检查范围

通过 `git diff` 和 `git status` 获取本次改动的所有文件列表和具体变更内容。

如果工作区是干净的（无改动），则对比最近一次 commit：`git diff HEAD~1`。

### 2. 读取检查清单

读取 `docs/guides/development/bug-checklist.md`，获取所有检查项。

### 3. 分类筛选

根据改动文件类型，确定需要检查的章节：

| 改动范围 | 必查章节 |
|----------|----------|
| 云函数 (`app/cloudfunctions/`) | 一（数据嵌套）、二（查询限制）、三（数值边界）、四（前后端一致性）、五（并发与原子性） |
| 前端页面/组件 (`app/src/`) | 四（前后端一致性）、六（路由与前端）、七（React 列表与状态）、九（日期格式） |
| 数据库相关（涉及集合操作） | 一（数据嵌套）、二（查询限制）、八（级联操作） |
| 积分/等级逻辑 | 三（数值边界） |

如果改动同时涉及多个范围，合并所有相关章节。

### 4. 逐项检查

对每个适用的检查项：

1. 在本次改动中搜索相关代码模式
2. 判断是否存在问题
3. 给出结论：✅ 通过 / ⚠️ 需关注 / ❌ 存在问题

### 5. 输出报告

按以下格式输出检查结果：

```
## Bug 检查报告

**检查范围**：列出本次改动的文件
**适用章节**：列出检查的章节编号

### 检查结果

| # | 检查项 | 结果 | 说明 |
|---|--------|------|------|
| 1.1 | .where() 用 _.or() 双路径 | ✅ | 未涉及数据库查询 |
| 7.2 | 切换数据源清空旧状态 | ❌ | useEffect 未清空旧列表 |
| ... | ... | ... | ... |

### 需要修复的问题

（如有 ❌ 项，列出具体问题和修复建议）

### 总结

N 项检查，M 项通过，X 项需关注，Y 项需修复。
```

### 6. 可选修复

如果发现 ❌ 问题，询问用户是否需要立即修复。得到确认后直接修改代码。
