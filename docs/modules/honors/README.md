# 荣誉榜与记录模块

> 展示学生荣誉排名和幻兽成长状态，提供积分记录查看与导出功能。

## 功能概述

### 荣誉榜

- **排名规则** —— 按徽章数量排序，徽章相同时按当前等级排序
- **展示内容** —— 每个学生卡片包含：
  - 幻兽形象（当前进化阶段的图片）
  - 当前等级和经验进度条
  - 已获得的徽章列表
  - 学生姓名和班级

### 积分记录

- **分页加载** —— 记录数量较大时支持分页浏览
- **日期分组** —— 记录按日期分组展示，便于查看每日操作
- **记录详情** —— 每条记录显示：学生姓名、评分规则、分值、操作时间
- **CSV 导出** —— 支持将积分记录导出为 CSV 文件，便于存档或打印

## 关键文件

| 文件 | 说明 |
|------|------|
| `app/src/routes/Honors.tsx` | 荣誉榜页面 |
| `app/src/routes/Records.tsx` | 积分记录页面 |
| `app/src/services/cloudApi.ts` | API 封装 |

## 云函数 / API

| 云函数 | API 方法 | 说明 |
|--------|----------|------|
| `TT_honors_list` | `honorsList` | 获取荣誉榜数据（含排名） |
| `TT_record_list` | `recordList` | 获取积分记录（分页） |
| `TT_record_export` | `recordExport` | 导出积分记录为 CSV |

## 数据来源

荣誉榜和记录模块本身不维护独立的数据集合，数据来源于：

| 数据 | 来源集合 | 说明 |
|------|----------|------|
| 学生信息 | `TT_students` | 姓名、等级、幻兽、徽章 |
| 积分记录 | `TT_records` | 评分和撤销的历史记录 |

## 荣誉榜排名算法

```
排名优先级：
1. 徽章数量（降序）—— 徽章越多排名越高
2. 当前等级（降序）—— 等级越高排名越高
3. 累计积分（降序）—— 同级时积分高者优先
```

## CSV 导出格式

导出的 CSV 文件包含以下列：

| 列名 | 说明 |
|------|------|
| 学生姓名 | 操作对象 |
| 评分规则 | 使用的规则名称 |
| 分值 | 加减分数值 |
| 操作类型 | score（评分）/ revoke（撤销） |
| 操作时间 | 格式化的日期时间字符串 |

## 注意事项

- 荣誉榜数据在每次进入页面时实时从后端获取，确保排名准确
- 积分记录按时间倒序排列，最新的记录在最前面
- CSV 导出包含当前班级的全部记录，不受前端分页限制
- 荣誉榜的幻兽图片展示依赖 [幻兽系统](../beast-system/README.md) 的资源
- 积分记录的数据由 [积分系统](../score-system/README.md) 写入
